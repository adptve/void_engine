[package]
name = "void_presenter"
version = "0.1.0"
edition = "2021"
description = "Presenter abstraction for Void Engine - multi-platform output adapters"
license = "MIT OR Apache-2.0"

[dependencies]
# Workspace dependencies
void_core = { path = "../void_core" }

# Concurrency
parking_lot = "0.12"

# Serialization
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"

# Logging
log = "0.4"

# Error handling
thiserror = "1.0"

# Math
glam = "0.24"

# Graphics (optional, for desktop presenter)
wgpu = { version = "0.20", optional = true }
winit = { version = "0.29", optional = true }

# XR support (optional)
void_xr = { path = "../void_xr", optional = true }

[features]
default = []
desktop = ["wgpu", "winit"]
drm-backend = ["wgpu", "dep:drm", "dep:gbm", "dep:nix"]
webgpu = []
webxr = ["web"]
# Web feature for WASM/WebGPU target
web = ["wgpu", "dep:wasm-bindgen", "dep:wasm-bindgen-futures", "dep:web-sys", "dep:js-sys"]
# XR presenter (bridges void_xr with void_render)
xr = ["wgpu", "dep:void_xr"]

# DRM/KMS (Linux only, for direct GPU rendering without display server)
[target.'cfg(target_os = "linux")'.dependencies]
drm = { version = "0.12", optional = true }
gbm = { version = "0.15", features = ["drm-support"], optional = true }
nix = { version = "0.29", features = ["ioctl", "fs"], optional = true }

# WASM/WebGPU dependencies (wasm32 target only)
[target.'cfg(target_arch = "wasm32")'.dependencies]
wasm-bindgen = { version = "0.2", optional = true }
wasm-bindgen-futures = { version = "0.4", optional = true }
js-sys = { version = "0.3", optional = true }
# Note: WebGPU (Gpu*) features require RUSTFLAGS="--cfg=web_sys_unstable_apis"
# wgpu handles WebGPU integration internally, so we only need stable web-sys features here
web-sys = { version = "0.3", optional = true, features = [
    # Core DOM (stable)
    "Window",
    "Document",
    "Element",
    "HtmlCanvasElement",
    "DomRect",

    # Animation/Timing (stable)
    "Performance",

    # Events (stable)
    "Event",
    "EventTarget",
    "MouseEvent",
    "KeyboardEvent",
    "WheelEvent",
    "TouchEvent",
    "Touch",
    "TouchList",
    "PointerEvent",
    "FocusEvent",
    "UiEvent",

    # Navigator (stable)
    "Navigator",

    # Console (stable)
    "console",

    # WebGL (stable - for fallback)
    "WebGlRenderingContext",
    "WebGl2RenderingContext",

    # Gamepad (stable)
    "Gamepad",
    "GamepadButton",
    "GamepadEvent",
]}

# Note: WebXR features also require unstable APIs. For WebXR support,
# build with: RUSTFLAGS="--cfg=web_sys_unstable_apis" cargo build --target wasm32-unknown-unknown

[dev-dependencies]
pollster = "0.3"
env_logger = "0.11"

[[example]]
name = "desktop_basic"
required-features = ["desktop"]

[[example]]
name = "multi_presenter"
required-features = ["desktop"]
